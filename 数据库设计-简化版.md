# 电商系统数据库设计（简化版）

> **版本说明**：这是简化版数据库设计，适用于单商家、轻量级部署场景。移除了 Redis 缓存、支付相关表、优惠券表等。

## 1. 数据库选型

- **主数据库**：MySQL 8.0（仅此一个数据库）
- **字符集**：utf8mb4
- **存储引擎**：InnoDB
- **移除**：Redis 缓存数据库

## 2. 核心数据表设计（简化版）

### 2.1 用户模块

#### users - 用户基础信息表（简化）
```sql
CREATE TABLE users (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    nickname VARCHAR(50) COMMENT '昵称',
    avatar_url VARCHAR(255) COMMENT '头像URL（本地路径）',
    status TINYINT DEFAULT 1 COMMENT '状态: 1-正常, 0-禁用',
    last_login_at TIMESTAMP NULL COMMENT '最后登录时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

**简化说明**：
- ❌ 移除邮箱字段（不需要邮箱验证）
- ❌ 移除手机号字段（不需要手机验证）
- ❌ 移除邮箱/手机验证时间字段
- ✅ 保留基础字段：用户名、密码、昵称、头像

#### user_addresses - 用户收货地址表
```sql
CREATE TABLE user_addresses (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT UNSIGNED NOT NULL,
    receiver_name VARCHAR(50) NOT NULL COMMENT '收货人姓名',
    receiver_phone VARCHAR(20) NOT NULL COMMENT '收货人电话',
    province VARCHAR(50) NOT NULL COMMENT '省份',
    city VARCHAR(50) NOT NULL COMMENT '城市',
    district VARCHAR(50) NOT NULL COMMENT '区县',
    address VARCHAR(255) NOT NULL COMMENT '详细地址',
    postal_code VARCHAR(10) COMMENT '邮编',
    is_default TINYINT DEFAULT 0 COMMENT '是否默认地址',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户地址表';
```

### 2.2 商品模块

#### categories - 商品分类表（简化，最多二级）
```sql
CREATE TABLE categories (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    parent_id BIGINT UNSIGNED DEFAULT 0 COMMENT '父分类ID, 0表示顶级分类',
    name VARCHAR(100) NOT NULL COMMENT '分类名称',
    image_url VARCHAR(255) COMMENT '分类图片（本地路径）',
    sort_order INT DEFAULT 0 COMMENT '排序',
    is_show TINYINT DEFAULT 1 COMMENT '是否显示: 1-显示, 0-隐藏',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_parent_id (parent_id),
    INDEX idx_is_show (is_show)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品分类表';
```

**简化说明**：
- ❌ 移除 slug 字段（不需要 SEO 友好的 URL）
- ✅ 限制最多二级分类（parent_id 只能为 0 或一级分类 ID）

#### products - 商品基础信息表（简化）
```sql
CREATE TABLE products (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    category_id BIGINT UNSIGNED NOT NULL COMMENT '分类ID',
    name VARCHAR(200) NOT NULL COMMENT '商品名称',
    subtitle VARCHAR(255) COMMENT '商品副标题',
    main_image_url VARCHAR(255) COMMENT '主图URL（本地路径）',
    detail TEXT COMMENT '商品详情（HTML）',
    price DECIMAL(10, 2) NOT NULL COMMENT '商品价格',
    original_price DECIMAL(10, 2) COMMENT '原价',
    stock INT DEFAULT 0 COMMENT '库存',
    sales_count INT DEFAULT 0 COMMENT '销量',
    view_count INT DEFAULT 0 COMMENT '浏览量',
    status TINYINT DEFAULT 1 COMMENT '状态: 1-上架, 0-下架',
    sort_order INT DEFAULT 0 COMMENT '排序',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id),
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    INDEX idx_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品表';
```

**简化说明**：
- ❌ 移除品牌表关联（brand_id），单商家不需要品牌管理
- ❌ 移除复杂的 SKU 表（如需要可后续添加简化版）
- ✅ 保留基础字段和价格、库存管理

#### product_images - 商品图片表
```sql
CREATE TABLE product_images (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    image_url VARCHAR(255) NOT NULL COMMENT '图片URL（本地路径）',
    sort_order INT DEFAULT 0 COMMENT '排序',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    INDEX idx_product_id (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品图片表';
```

**说明**：
- 图片存储在本地 `uploads/products/` 目录
- 图片路径存储在数据库

### 2.3 购物车模块

#### cart_items - 购物车商品表（仅登录用户）
```sql
CREATE TABLE cart_items (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT UNSIGNED NOT NULL COMMENT '用户ID（仅登录用户）',
    product_id BIGINT UNSIGNED NOT NULL,
    quantity INT NOT NULL DEFAULT 1 COMMENT '数量',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_product (user_id, product_id),
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='购物车表';
```

**简化说明**：
- ✅ **仅登录用户使用数据库购物车**：未登录用户使用浏览器 localStorage
- ❌ 移除 SKU 支持（简化版不支持规格）
- ✅ 一个用户一个商品只能有一条记录
- ✅ 未登录用户的购物车数据存储在浏览器 localStorage 中

### 2.4 订单模块（简化）

#### orders - 订单主表（简化，无支付，支持未登录用户）
```sql
CREATE TABLE orders (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    order_no VARCHAR(32) UNIQUE NOT NULL COMMENT '订单号',
    user_id BIGINT UNSIGNED NULL COMMENT '用户ID（可为空，支持未登录用户下单）',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '订单状态: 1-待付款, 2-待发货, 3-待收货, 4-已完成, 5-已取消',
    total_amount DECIMAL(10, 2) NOT NULL COMMENT '订单总金额',
    freight_amount DECIMAL(10, 2) DEFAULT 0 COMMENT '运费',
    pay_amount DECIMAL(10, 2) NOT NULL COMMENT '实付金额（总金额+运费）',
    receiver_name VARCHAR(50) NOT NULL COMMENT '收货人',
    receiver_phone VARCHAR(20) NOT NULL COMMENT '收货电话',
    receiver_address VARCHAR(500) NOT NULL COMMENT '收货地址',
    remark VARCHAR(500) COMMENT '订单备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_order_no (order_no),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at),
    INDEX idx_receiver_phone (receiver_phone) COMMENT '通过手机号查询订单'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

**简化说明**：
- ✅ **user_id 可为空**：支持未登录用户下单
- ✅ **订单查询**：未登录用户可通过订单号（order_no）和收货电话（receiver_phone）查询订单
- ❌ 移除支付方式字段（payment_method）
- ❌ 移除支付状态字段（payment_status）
- ❌ 移除支付时间字段（paid_at）
- ❌ 移除优惠金额字段（discount_amount，无优惠券）
- ✅ 订单创建后默认为"待付款"状态
- ✅ 管理员手动修改状态流程：待付款 → 待发货 → 待收货 → 已完成
- ✅ 登录用户可通过 user_id 查询所有订单
- ✅ 未登录用户只能通过订单号和手机号查询单个订单

#### order_items - 订单商品明细表
```sql
CREATE TABLE order_items (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    order_id BIGINT UNSIGNED NOT NULL,
    product_id BIGINT UNSIGNED NOT NULL,
    product_name VARCHAR(200) NOT NULL COMMENT '商品名称（快照）',
    product_image VARCHAR(255) COMMENT '商品图片（快照）',
    price DECIMAL(10, 2) NOT NULL COMMENT '单价（快照）',
    quantity INT NOT NULL COMMENT '数量',
    total_amount DECIMAL(10, 2) NOT NULL COMMENT '小计',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_order_id (order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单商品明细表';
```

**简化说明**：
- ❌ 移除 SKU 相关字段（简化版不支持规格）
- ✅ 保留商品信息快照（即使商品后续修改，订单信息不变）

### 2.5 管理后台模块（简化）

#### admins - 管理员表（简化权限）
```sql
CREATE TABLE admins (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    name VARCHAR(50) COMMENT '真实姓名',
    status TINYINT DEFAULT 1 COMMENT '状态: 1-正常, 0-禁用',
    last_login_at TIMESTAMP NULL COMMENT '最后登录时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='管理员表';
```

**简化说明**：
- ❌ 移除角色权限系统（单角色，所有管理员权限相同）
- ❌ 移除邮箱字段（不需要）
- ✅ 保留基础管理功能

### 2.6 移除的表

以下表在简化版中已移除：
- ❌ `user_profiles` - 用户详细资料表（合并到 users 表）
- ❌ `user_accounts` - 用户账户表（无积分余额功能）
- ❌ `product_skus` - 商品规格表（不支持复杂规格）
- ❌ `product_attributes` - 商品属性表
- ❌ `product_reviews` - 商品评价表（无评价功能）
- ❌ `brands` - 品牌表（单商家不需要）
- ❌ `payments` - 支付记录表（无在线支付）
- ❌ `coupons` - 优惠券表（无优惠券功能）
- ❌ `user_coupons` - 用户优惠券表
- ❌ `promotions` - 促销活动表
- ❌ `roles` - 角色表（单角色）
- ❌ `permissions` - 权限表
- ❌ `admin_roles` - 管理员角色关联表
- ❌ `role_permissions` - 角色权限关联表
- ❌ `order_status_history` - 订单状态变更历史表（可选，简化版不记录）
- ❌ `refunds` - 退款记录表（简化版不支持退款）

## 3. 数据库优化建议（简化版）

### 3.1 索引优化
- 为常用查询字段建立索引（已在上面的表定义中）
- 避免过度索引（影响写入性能）
- 定期分析慢查询日志

### 3.2 查询优化
- 使用 LIMIT 限制查询数量
- 避免 SELECT *，只查询需要的字段
- 合理使用 JOIN，避免过度关联
- 对于商品列表，使用分页查询

### 3.3 存储优化
- 定期清理无效数据（如已删除商品的购物车项）
- 订单数据可定期归档（如超过 1 年的订单）
- 图片路径使用相对路径，便于迁移

### 3.4 备份策略
- 定期备份数据库（建议每天一次）
- 备份文件存储在本地或其他服务器
- 保留最近 7 天的备份文件

## 4. 数据库初始化脚本示例

```sql
-- 创建数据库
CREATE DATABASE ecommerce_simple CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE ecommerce_simple;

-- 创建用户表
CREATE TABLE users (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    nickname VARCHAR(50) COMMENT '昵称',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    status TINYINT DEFAULT 1 COMMENT '状态: 1-正常, 0-禁用',
    last_login_at TIMESTAMP NULL COMMENT '最后登录时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 创建其他表...
-- （按照上面的表定义依次创建）

-- 插入默认管理员（密码：admin123，需要在实际使用时修改）
INSERT INTO admins (username, password_hash, name, status) 
VALUES ('admin', '$2b$10$YourHashedPasswordHere', '管理员', 1);

-- 插入示例分类
INSERT INTO categories (parent_id, name, sort_order, is_show) VALUES
(0, '电子产品', 1, 1),
(0, '服装', 2, 1);

-- 注意：实际密码需要使用 bcrypt 加密后的哈希值
```

## 5. 数据库维护建议

### 5.1 定期维护
- 每周检查数据库大小
- 每月分析慢查询日志
- 每季度优化表结构（如需要）

### 5.2 数据清理
- 清理超过 30 天未登录的用户购物车
- 归档超过 1 年的订单数据（可选）
- 删除已下架商品的图片文件（需要手动清理）

### 5.3 性能监控
- 监控数据库连接数
- 监控查询执行时间
- 监控表大小增长

## 6. 与原版对比

| 表名 | 完整版 | 简化版 |
|------|--------|--------|
| users | 包含邮箱、手机验证 | ✅ 仅用户名、密码 |
| user_profiles | 独立表 | ❌ 合并到 users |
| user_addresses | ✅ | ✅ 保留 |
| categories | ✅ | ✅ 保留（简化） |
| products | 包含品牌 | ✅ 保留（移除品牌） |
| product_skus | ✅ | ❌ 移除 |
| product_images | ✅ | ✅ 保留 |
| cart_items | 支持 SKU | ✅ 简化（无 SKU） |
| orders | 包含支付字段 | ✅ 简化（无支付） |
| order_items | 支持 SKU | ✅ 简化（无 SKU） |
| payments | ✅ | ❌ 移除 |
| coupons | ✅ | ❌ 移除 |
| product_reviews | ✅ | ❌ 移除 |
| brands | ✅ | ❌ 移除 |
| admins | 多角色权限 | ✅ 简化（单角色） |
| roles | ✅ | ❌ 移除 |
| permissions | ✅ | ❌ 移除 |

**总计**：
- 完整版：约 20+ 张表
- 简化版：约 7 张核心表

---

**文档版本**：v2.0（简化版）  
**创建日期**：2026.1.9  
**适用场景**：小型电商、个人商家、轻量级部署
