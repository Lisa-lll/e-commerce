# 黄石小店 - 系统启动说明


## 📋 目录

- [环境要求](#环境要求)
- [后端启动步骤](#后端启动步骤)
- [前端启动步骤](#前端启动步骤)
- [访问地址](#访问地址)
- [常见问题](#常见问题)

---

## 🔧 环境要求

### 后端环境
- **Python**: 3.9 或更高版本
- **MySQL**: 8.0 或更高版本
- **pip**: Python 包管理器

### 前端环境
- **Node.js**: 18.0 或更高版本
- **npm**: 随 Node.js 一起安装

### 数据库配置
- 数据库名：`ecommerce_simple`
- 用户名：`root`
- 密码：`nihao123`
- 主机：`localhost`
- 端口：`3306`

---

## 🚀 后端启动步骤

### 1. 进入后端目录

```bash
cd backend
```

### 2. 激活虚拟环境

**Windows (PowerShell):**
```powershell
.\venv\Scripts\Activate.ps1
```

**Windows (CMD):**
```cmd
venv\Scripts\activate.bat
```

**Linux/Mac:**
```bash
source venv/bin/activate
```

### 3. 安装依赖（首次启动或更新依赖后）

```bash
pip install -r requirements.txt
```

### 4. 配置环境变量

确保 `backend/.env` 文件存在，内容如下：

```env
# Django 配置
SECRET_KEY=django-insecure-change-this-in-production
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# 数据库配置
DB_NAME=ecommerce_simple
DB_USER=root
DB_PASSWORD=nihao123
DB_HOST=localhost
DB_PORT=3306

# JWT 配置
JWT_SECRET=your_jwt_secret_key_here_change_in_production
JWT_EXPIRE_DAYS=7

# 文件上传配置
MAX_FILE_SIZE=5242880

# 应用配置
FRONTEND_URL=http://localhost:5173
ADMIN_URL=http://localhost:5174
```

如果 `.env` 文件不存在，可以运行：
```bash
python create_env.py
```

### 5. 执行数据库迁移（首次启动或数据库结构变更后）

```bash
python manage.py makemigrations
python manage.py migrate
```

### 6. 创建超级管理员（首次启动）

```bash
python create_superuser.py
```

默认账号：
- 用户名：`admin`
- 密码：`admin123`

### 7. 创建测试数据（可选）

```bash
python create_test_data.py
```

### 8. 启动开发服务器

```bash
python manage.py runserver 0.0.0.0:8000
```

或者指定端口：
```bash
python manage.py runserver 0.0.0.0:8000
```

### 9. 验证后端服务

打开浏览器访问：
- 健康检查：http://localhost:8000/health
- API 信息：http://localhost:8000/api/v1/
- Django Admin：http://localhost:8000/admin/

---

## 🎨 前端启动步骤

### 1. 进入前端目录

```bash
cd frontend
```

### 2. 安装依赖（首次启动或更新依赖后）

```bash
npm install
```

### 3. 配置环境变量（可选）

创建 `frontend/.env` 文件（如果不存在）：

```env
VITE_API_BASE_URL=http://localhost:8000/api/v1
```

### 4. 启动开发服务器

```bash
npm run dev
```

### 5. 验证前端服务

打开浏览器访问：http://localhost:5173

---

## 🌐 访问地址

### 前端地址
- **首页**: http://localhost:5173/
- **商品列表**: http://localhost:5173/products
- **购物车**: http://localhost:5173/cart
- **订单查询**: http://localhost:5173/order/query

### 后端地址
- **Django Admin**: http://localhost:8000/admin/
- **API 健康检查**: http://localhost:8000/health
- **API 信息**: http://localhost:8000/api/v1/

### 管理后台
- **登录地址**: http://localhost:8000/admin/
- **默认账号**: admin / admin123

---

## ⚠️ 常见问题

### 后端问题

#### 1. 数据库连接失败

**错误信息**: `MySQLdb.OperationalError: (1045, "Access denied")`

**解决方法**:
- 检查 `.env` 文件中的数据库配置是否正确
- 确认 MySQL 服务已启动
- 验证数据库用户名和密码

#### 2. 模块未找到

**错误信息**: `ModuleNotFoundError: No module named 'xxx'`

**解决方法**:
```bash
pip install -r requirements.txt
```

#### 3. 迁移错误

**错误信息**: `django.db.utils.OperationalError`

**解决方法**:
- 确认数据库已创建
- 检查数据库连接配置
- 尝试删除迁移文件后重新迁移（谨慎操作）

#### 4. 端口被占用

**错误信息**: `Error: That port is already in use`

**解决方法**:
- 停止占用端口的进程
- 或使用其他端口：`python manage.py runserver 0.0.0.0:8001`

### 前端问题

#### 1. 依赖安装失败

**错误信息**: `npm ERR!`

**解决方法**:
```bash
# 清除缓存
npm cache clean --force

# 删除 node_modules 和 package-lock.json
rm -rf node_modules package-lock.json

# 重新安装
npm install
```

#### 2. 端口被占用

**错误信息**: `Port 5173 is in use`

**解决方法**:
- 停止占用端口的进程
- 或修改 `vite.config.ts` 中的端口配置

#### 3. API 请求失败

**错误信息**: `Network Error` 或 `404 Not Found`

**解决方法**:
- 确认后端服务已启动
- 检查 `frontend/vite.config.ts` 中的代理配置
- 验证 API 基础 URL 配置

#### 4. 页面空白或错误

**解决方法**:
- 打开浏览器开发者工具（F12）查看控制台错误
- 检查后端服务是否正常运行
- 清除浏览器缓存后刷新

---

## 📝 快速启动命令（Windows PowerShell）

### 后端启动（新终端窗口）

```powershell
cd d:\project\e-commerce\backend
.\venv\Scripts\Activate.ps1
python manage.py runserver 0.0.0.0:8000
```

### 前端启动（新终端窗口）

```powershell
cd d:\project\e-commerce\frontend
npm run dev
```

---

## 🔄 重启服务

### 重启后端

1. 在运行后端的终端按 `Ctrl+C` 停止服务
2. 重新运行启动命令

### 重启前端

1. 在运行前端的终端按 `Ctrl+C` 停止服务
2. 重新运行 `npm run dev`

---

## 📦 项目结构

```
e-commerce/
├── backend/              # 后端（Django）
│   ├── venv/            # Python 虚拟环境
│   ├── ecommerce/       # Django 项目配置
│   ├── users/           # 用户模块
│   ├── products/        # 商品模块
│   ├── orders/          # 订单模块
│   ├── admins/          # 管理员模块
│   ├── uploads/         # 上传文件目录
│   ├── manage.py        # Django 管理脚本
│   ├── requirements.txt # Python 依赖
│   └── .env             # 环境变量配置
│
└── frontend/            # 前端（React + Vite）
    ├── src/             # 源代码
    │   ├── api/         # API 接口
    │   ├── components/  # 组件
    │   ├── pages/       # 页面
    │   └── utils/       # 工具函数
    ├── public/          # 静态资源
    ├── package.json     # Node.js 依赖
    └── vite.config.ts   # Vite 配置
```

---

## 🎯 开发建议

1. **保持服务运行**: 开发时保持前后端服务都在运行
2. **查看日志**: 注意终端输出的错误信息
3. **浏览器控制台**: 使用 F12 打开开发者工具查看前端错误
4. **数据库备份**: 重要数据变更前建议备份数据库
5. **代码热重载**: 前后端都支持热重载，修改代码后自动刷新

---

## 📞 技术支持

如遇到问题，请检查：
1. 环境变量配置是否正确
2. 数据库服务是否启动
3. 端口是否被占用
4. 依赖是否完整安装
5. 浏览器控制台和终端错误信息

---

**最后更新**: 2026-01-13
**系统名称**: 黄石小店
