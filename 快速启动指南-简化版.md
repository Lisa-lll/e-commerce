# 电商系统快速启动指南（简化版）

> **版本说明**：这是简化版快速启动指南，适用于单商家、轻量级部署场景。移除了 Redis、对象存储等组件的配置。

## 1. 环境要求

### 1.1 开发环境
- **Node.js**: 18.0.0 或更高版本
- **npm**: 9.0.0 或更高版本（或使用 yarn/pnpm）
- **MySQL**: 8.0 或更高版本
- **Git**: 2.0 或更高版本

### 1.2 可选工具
- **PM2**: 用于生产环境进程管理
- **Postman**: API 测试工具
- **VS Code**: 推荐的代码编辑器

**移除：** Redis（不需要）、Docker（可选）

### 1.3 服务器要求（生产环境）

**最低配置：**
- **CPU**: 1 核
- **内存**: 1GB（推荐 2GB）
- **存储**: 20GB SSD
- **系统**: Linux（Ubuntu 20.04+ / CentOS 7+）

## 2. 项目初始化

### 2.1 创建项目结构
```
e-commerce/
├── frontend/          # 前端项目
├── backend/           # 后端项目
├── admin/             # 管理后台项目
└── README.md          # 项目说明
```

## 3. 后端项目初始化

### 3.1 创建后端项目
```bash
mkdir backend && cd backend
npm init -y
```

### 3.2 安装依赖（简化版）

**核心依赖：**
```bash
# Express 和相关中间件
npm install express cors helmet morgan dotenv
npm install express-validator joi

# 数据库
npm install mysql2 prisma @prisma/client

# 认证和安全
npm install jsonwebtoken bcrypt
npm install multer

# 日志
npm install winston

# TypeScript 相关（开发依赖）
npm install -D typescript @types/node @types/express @types/cors @types/morgan
npm install -D @types/bcrypt @types/jsonwebtoken @types/multer
npm install -D ts-node nodemon
npm install -D @typescript-eslint/eslint-plugin @typescript-eslint/parser
npm install -D eslint prettier eslint-config-prettier
```

### 3.3 初始化 TypeScript
```bash
npx tsc --init
```

修改 `tsconfig.json`：
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### 3.4 初始化 Prisma
```bash
npx prisma init
```

### 3.5 后端项目结构
```
backend/
├── src/
│   ├── config/          # 配置文件
│   ├── controllers/     # 控制器
│   ├── services/        # 业务逻辑
│   ├── models/          # 数据模型（Prisma）
│   ├── middlewares/     # 中间件
│   ├── routes/          # 路由
│   ├── utils/           # 工具函数
│   ├── validators/      # 数据验证
│   ├── types/           # TypeScript 类型
│   └── app.ts           # 应用入口
├── prisma/
│   ├── schema.prisma    # Prisma schema
│   └── migrations/      # 数据库迁移
├── uploads/             # 文件上传目录
│   ├── avatars/         # 用户头像
│   ├── products/        # 商品图片
│   └── categories/      # 分类图片
├── .env                 # 环境变量
├── .env.example         # 环境变量示例
├── package.json
├── tsconfig.json
└── README.md
```

### 3.6 环境变量配置（.env）

**简化版配置（无 Redis、无对象存储）：**
```env
# 服务器配置
PORT=3000
NODE_ENV=development

# 数据库配置
DATABASE_URL="mysql://user:password@localhost:3306/ecommerce_simple"
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=ecommerce_simple

# JWT 配置
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRE=7d

# 文件上传配置
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880

# 应用配置
APP_URL=http://localhost:3000
FRONTEND_URL=http://localhost:5173
ADMIN_URL=http://localhost:5174
```

### 3.7 package.json 脚本

```json
{
  "scripts": {
    "dev": "nodemon src/app.ts",
    "build": "tsc",
    "start": "node dist/app.js",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio"
  }
}
```

## 4. 前端项目初始化

### 4.1 创建前端项目
```bash
cd ..
npm create vite@latest frontend -- --template react-ts
cd frontend
```

### 4.2 安装依赖（简化版）

```bash
npm install
npm install react-router-dom
npm install axios
npm install zustand
npm install antd @ant-design/icons
npm install dayjs
npm install -D @types/react-router-dom
```

### 4.3 前端项目结构
```
frontend/
├── public/              # 静态资源
├── src/
│   ├── api/             # API 接口
│   ├── assets/          # 资源文件
│   ├── components/      # 通用组件
│   ├── pages/           # 页面组件
│   │   ├── Home/        # 首页
│   │   ├── Products/    # 商品列表/详情
│   │   ├── Cart/        # 购物车
│   │   ├── Order/       # 订单
│   │   └── User/        # 用户中心
│   ├── hooks/           # 自定义 Hooks
│   ├── store/           # 状态管理（Zustand）
│   ├── utils/           # 工具函数
│   ├── types/           # TypeScript 类型
│   ├── App.tsx          # 根组件
│   └── main.tsx         # 入口文件
├── .env                 # 环境变量
├── .env.example
├── package.json
├── vite.config.ts
└── tsconfig.json
```

### 4.4 前端环境变量（.env）

```env
VITE_API_BASE_URL=http://localhost:3000/api/v1
VITE_APP_TITLE=电商系统
```

## 5. 管理后台项目初始化

### 5.1 创建管理后台项目
```bash
cd ..
npm create vite@latest admin -- --template react-ts
cd admin
```

### 5.2 安装依赖

```bash
npm install
npm install react-router-dom
npm install axios
npm install zustand
npm install antd @ant-design/icons
npm install dayjs
npm install -D @types/react-router-dom
```

### 5.3 管理后台项目结构
```
admin/
├── public/
├── src/
│   ├── api/
│   ├── components/
│   ├── pages/
│   │   ├── Dashboard/   # 仪表盘
│   │   ├── Products/    # 商品管理
│   │   ├── Orders/      # 订单管理
│   │   ├── Users/       # 用户管理
│   │   └── Categories/  # 分类管理
│   ├── layout/          # 布局组件
│   ├── hooks/
│   ├── store/
│   ├── utils/
│   ├── types/
│   ├── App.tsx
│   └── main.tsx
├── .env
├── package.json
└── vite.config.ts
```

### 5.4 管理后台环境变量（.env）

```env
VITE_API_BASE_URL=http://localhost:3000/api/v1/admin
VITE_APP_TITLE=电商管理后台
```

## 6. 数据库初始化

### 6.1 创建数据库
```sql
CREATE DATABASE ecommerce_simple CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 6.2 配置 Prisma Schema

编辑 `backend/prisma/schema.prisma`：
```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// 用户表
model User {
  id            BigInt      @id @default(autoincrement())
  username      String      @unique @db.VarChar(50)
  passwordHash  String      @db.VarChar(255)
  nickname      String?     @db.VarChar(50)
  avatarUrl     String?     @db.VarChar(255)
  status        Int         @default(1)
  lastLoginAt   DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  addresses     UserAddress[]
  cartItems     CartItem[]
  orders        Order[]

  @@index([username])
  @@index([status])
  @@map("users")
}

// 其他模型...
// （参考数据库设计-简化版.md）
```

### 6.3 使用 Prisma 迁移
```bash
cd backend
npx prisma migrate dev --name init
```

### 6.4 生成 Prisma Client
```bash
npx prisma generate
```

### 6.5 初始化种子数据（可选）

创建 `backend/prisma/seed.ts`：
```typescript
import { PrismaClient } from '@prisma/client';
import bcrypt from 'bcrypt';

const prisma = new PrismaClient();

async function main() {
  // 创建默认管理员
  const hashedPassword = await bcrypt.hash('admin123', 10);
  await prisma.admin.upsert({
    where: { username: 'admin' },
    update: {},
    create: {
      username: 'admin',
      passwordHash: hashedPassword,
      name: '管理员',
      status: 1,
    },
  });

  // 创建示例分类
  await prisma.category.createMany({
    data: [
      { name: '电子产品', parentId: 0, sortOrder: 1, isShow: 1 },
      { name: '服装', parentId: 0, sortOrder: 2, isShow: 1 },
    ],
  });
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
```

在 `package.json` 中添加：
```json
{
  "prisma": {
    "seed": "ts-node prisma/seed.ts"
  }
}
```

运行种子数据：
```bash
npx prisma db seed
```

## 7. 启动项目（简化版）

### 7.1 启动后端

**开发环境：**
```bash
cd backend
npm run dev
# 后端服务运行在 http://localhost:3000
```

**生产环境：**
```bash
npm run build
pm2 start dist/app.js --name ecommerce-api
```

### 7.2 启动前端
```bash
cd frontend
npm run dev
# 前端服务运行在 http://localhost:5173
```

### 7.3 启动管理后台
```bash
cd admin
npm run dev
# 管理后台运行在 http://localhost:5174
```

## 8. Docker 部署（可选，简化版）

### 8.1 创建 docker-compose.yml（仅 MySQL）

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: ecommerce_mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: ecommerce_simple
      MYSQL_USER: ecommerce_user
      MYSQL_PASSWORD: ecommerce_password
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  mysql_data:
```

### 8.2 启动 Docker 服务（仅 MySQL）
```bash
docker-compose up -d
```

**说明**：简化版中，Node.js 应用不容器化，直接部署在服务器上

## 9. 生产环境部署

### 9.1 服务器部署步骤

**1. 连接服务器**
```bash
ssh user@your-server-ip
```

**2. 安装 Node.js 和 MySQL**
```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
sudo apt-get install mysql-server

# CentOS/RHEL
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs
sudo yum install mysql-server
```

**3. 安装 PM2**
```bash
npm install -g pm2
```

**4. 上传代码到服务器**
```bash
# 使用 git
git clone <repository-url>
cd e-commerce

# 或使用 scp
scp -r ./e-commerce user@server:/opt/
```

**5. 安装依赖并构建**
```bash
cd backend
npm install
npm run build

cd ../frontend
npm install
npm run build

cd ../admin
npm install
npm run build
```

**6. 配置环境变量**
```bash
cd backend
cp .env.example .env
# 编辑 .env 文件，配置生产环境参数
nano .env
```

**7. 初始化数据库**
```bash
cd backend
npx prisma migrate deploy
npx prisma generate
npx prisma db seed  # 可选
```

**8. 启动应用**
```bash
cd backend
pm2 start dist/app.js --name ecommerce-api
pm2 save
pm2 startup  # 设置开机自启
```

**9. 配置 Nginx（可选）**

创建 `/etc/nginx/sites-available/ecommerce`：
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # 前端
    location / {
        root /opt/e-commerce/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # 管理后台
    location /admin {
        alias /opt/e-commerce/admin/dist;
        try_files $uri $uri/ /admin/index.html;
    }

    # API 代理
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # 文件服务
    location /uploads {
        alias /opt/e-commerce/backend/uploads;
    }
}
```

启用配置：
```bash
sudo ln -s /etc/nginx/sites-available/ecommerce /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 9.2 不使用 Nginx 的部署（最简单）

**直接访问：**
- 前端：http://your-server-ip:5173
- 管理后台：http://your-server-ip:5174
- API：http://your-server-ip:3000

**注意**：确保防火墙开放相应端口

## 10. 开发流程（简化版）

### 10.1 功能开发步骤
1. **数据库设计**：在 `prisma/schema.prisma` 中定义模型
2. **运行迁移**：`npx prisma migrate dev`
3. **生成 Client**：`npx prisma generate`
4. **后端开发**：编写 Controller、Service、Route
5. **前端开发**：编写页面和组件
6. **联调测试**：前后端联调

### 10.2 代码规范
- 使用 ESLint 和 Prettier
- 遵循 TypeScript 类型检查
- 提交前运行 lint 检查

### 10.3 Git 工作流（简化）
```bash
# 创建功能分支
git checkout -b feature/user-module

# 提交代码
git add .
git commit -m "feat: 添加用户模块"

# 推送到远程
git push origin feature/user-module

# 合并到主分支
git checkout main
git merge feature/user-module
```

## 11. 常见问题（简化版）

### 11.1 数据库连接失败
- 检查数据库服务是否启动
- 检查 .env 中的数据库配置是否正确
- 检查 MySQL 用户权限

### 11.2 文件上传失败
- 检查 `uploads/` 目录是否存在
- 检查目录权限：`chmod 755 uploads`
- 检查文件大小限制

### 11.3 Prisma 迁移失败
- 检查数据库连接
- 检查 schema.prisma 语法
- 可以手动重置数据库：`npx prisma migrate reset`（开发环境）

### 11.4 端口冲突
- 修改 .env 中的端口配置
- 或使用 `lsof -i :3000` 查看占用端口的进程

### 11.5 内存不足
- 简化版应该在 1GB 内存下运行
- 如果内存不足，考虑：
  - 减少 Node.js 进程数
  - 优化数据库查询
  - 减少日志输出

## 12. 性能优化建议（简化版）

### 12.1 前端优化
- 启用代码分割和懒加载
- 压缩图片
- 使用 HTTP 缓存头

### 12.2 后端优化
- 数据库索引优化
- 避免 N+1 查询
- 使用连接池
- 限制查询结果数量

### 12.3 资源优化
- 定期清理未使用的上传文件
- 定期清理日志文件
- 优化数据库表（定期 ANALYZE）

## 13. 备份策略（简化版）

### 13.1 数据库备份
```bash
# 创建备份脚本 backup.sh
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
mysqldump -u root -p ecommerce_simple > backup_$DATE.sql
# 保留最近 7 天的备份
find . -name "backup_*.sql" -mtime +7 -delete
```

### 13.2 文件备份
```bash
# 备份上传文件
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz uploads/
```

### 13.3 自动备份
```bash
# 添加到 crontab
0 2 * * * /path/to/backup.sh  # 每天凌晨 2 点备份
```

## 14. 监控和维护（简化版）

### 14.1 PM2 监控
```bash
pm2 monit                    # 实时监控
pm2 logs ecommerce-api       # 查看日志
pm2 status                   # 查看状态
```

### 14.2 系统监控
```bash
# 查看内存使用
free -h

# 查看磁盘使用
df -h

# 查看进程
ps aux | grep node
```

### 14.3 日志管理
- 日志存储在 `backend/logs/` 目录
- 定期清理旧日志（保留最近 7 天）
- 使用 `logrotate` 自动轮转日志

## 15. 下一步

1. 按照简化版方案逐步实现功能模块
2. 参考数据库设计-简化版.md 创建表结构
3. 根据技术栈选型说明-简化版.md 配置开发环境
4. 开始第一个功能模块的开发（建议从用户模块开始）

## 16. 与原版对比

| 项目 | 完整版 | 简化版 |
|------|--------|--------|
| 数据库 | MySQL + Redis | ✅ 仅 MySQL |
| Docker | 必需 | ❌ 可选 |
| Nginx | 推荐 | ⚠️ 可选 |
| PM2 | 推荐 | ✅ 推荐 |
| 文件存储 | 对象存储 | ✅ 本地文件 |
| 监控 | APM + ELK | ❌ 基础日志 |
| 备份 | 自动化 | ⚠️ 手动/简单脚本 |
| 部署复杂度 | 高 | ✅ 低 |

---

**提示**：简化版适合小规模部署和快速上线，后续可根据业务增长逐步升级到完整版。

---

**文档版本**：v2.0（简化版）  
**创建日期**：2026.1.9  
**适用场景**：小型电商、个人商家、轻量级部署
